<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tommy’s Classic American – Event Checklist</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4f7f8; color: #222; margin: 0; padding: 0 0 60px 0;}
    header { background: #185e36; color: #fff; padding: 24px 0 16px 0; text-align: center; }
    h1 { margin: 0; font-size: 2em;}
    .container { max-width: 1080px; margin: 20px auto; background: #fff; border-radius: 12px; padding: 20px 16px 16px 16px; box-shadow: 0 2px 12px rgba(34,34,34,0.07);}
    .months-list { display: flex; flex-wrap: wrap; gap: 24px; justify-content: space-between; }
    .month-block { flex: 1 1 200px; min-width: 220px; background: #f2f5f2; border-radius: 10px; margin-bottom: 24px; padding: 16px; box-shadow: 0 1px 3px rgba(24,94,54,.07); }
    .month-title { font-weight: bold; font-size: 1.15em; color: #185e36; margin-bottom: 10px; }
    .event-list { margin: 0; padding-left: 12px; }
    .event-list li { margin-bottom: 5px; cursor: pointer; }
    .event-list li:hover { text-decoration: underline; color: #185e36; }
    .small { color: #6c8c77; font-size: .98em; }
    .footer { background: #185e36; color: #fff; padding: 18px 0; position: fixed; width: 100vw; left: 0; bottom: 0; text-align: center; font-size: 1em; }
    @media (max-width:1200px) {
      .months-list { gap: 14px; }
      .month-block { min-width: 150px; padding: 10px; }
    }
    @media (max-width:800px) {
      .container { max-width: 99vw; }
      .months-list { flex-direction: column; gap: 0; }
      .month-block { margin-bottom: 18px; }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/ical@1.4.0/ical.min.js"></script>
</head>
<body>
  <header>
    <h1>Tommy’s Classic American</h1>
    <div style="font-size:1.1em; font-weight:400;">Event Prep Checklist</div>
  </header>
  <div class="container" id="main">
    <div id="calendar-loading" style="text-align:center;margin:50px 0;">Loading events from Apple Calendar...</div>
  </div>
  <div class="footer">Made for Tommy's Classic American Food Truck | Wooster, OH</div>
  <script>
    const ICAL_URL = 'https://p134-caldav.icloud.com/published/2/MTA2OTE0MDA1NTEwNjkxNBCj6Qo6e_6uWDS-2BesRjOsmZV5NV2TIIkwIVco1GZDPbuu1fzghh-I6rKZQAG0DjCD0DCuhcRD14eoskAaV78';
    // Helper: Month names
    const MONTHS = [
      'January', 'February', 'March', 'April', 'May', 'June',
      'July', 'August', 'September', 'October', 'November', 'December'
    ];
    function formatDate(d) {
      return d.toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric', hour:'2-digit', minute:'2-digit' });
    }
    async function fetchICalEvents() {
      const res = await fetch(ICAL_URL);
      const text = await res.text();
      const jcalData = ICAL.parse(text);
      const comp = new ICAL.Component(jcalData);
      const vevents = comp.getAllSubcomponents('vevent');
      const events = vevents.map(vevent => {
        const e = new ICAL.Event(vevent);
        return {
          summary: e.summary,
          location: e.location,
          start: e.startDate.toJSDate(),
          end: e.endDate.toJSDate(),
          description: e.description
        };
      });
      return events.filter(e => e.start.getFullYear() >= (new Date()).getFullYear());
    }
    // Render months grid with events
    function renderMonths(events) {
      const months = Array.from({length: 12}, (_, i) => []);
      events.forEach(ev => {
        const m = ev.start.getMonth();
        months[m].push(ev);
      });
      let html = '<div class="months-list">';
      for (let i = 0; i < 12; ++i) {
        html += `<div class="month-block">
          <div class="month-title">${MONTHS[i]}</div>
          <ul class="event-list">
            ${months[i].length === 0 ? '<li class="small">No events</li>' : months[i].map(ev =>
              `<li onclick="alert(\'Event: ${ev.summary.replace(/'/g, "&#39;")}\nDate: ${formatDate(ev.start)}\nLocation: ${(ev.location || '').replace(/'/g, "&#39;\")}")">
                ${ev.summary}<br><span class='small'>${formatDate(ev.start)}</span>
              </li>`
            ).join('')}
          </ul>
        </div>`;
      }
      html += '</div>';
      document.getElementById('main').innerHTML = html;
    }
    // MAIN: Fetch and display events under each month
    fetchICalEvents().then(renderMonths)
      .catch(err => {
        document.getElementById('main').innerHTML = `<div style='color:#b00;margin:40px;text-align:center;'>Could not load events.<br><span style='font-size:90%;'>${err.message}</span></div>`;
      });
  </script>
</body>
</html>
